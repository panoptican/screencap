{
	"master": {
		"tasks": [
			{
				"id": "1",
				"title": "Write cryptographic specification and threat model",
				"description": "Define the cryptographic primitives, key types, envelope formats, and security protocols for the E2EE system",
				"details": "Create comprehensive crypto spec including: Ed25519 device signing keypairs, X25519 key agreement keypairs, AES-GCM encryption with proper nonce handling, HKDF key derivation for room subkeys, canonical request signing format (method + path + timestamp + sha256(body)), envelope format for key distribution {ephemeralPub, nonce, ciphertext}, and threat model assumptions. Document all cryptographic operations and their security properties.",
				"testStrategy": "Review crypto spec with security experts, implement test vectors for all cryptographic operations, verify nonce uniqueness and proper key derivation",
				"priority": "high",
				"dependencies": [],
				"status": "done",
				"subtasks": [],
				"updatedAt": "2026-01-04T12:12:17.998Z"
			},
			{
				"id": "2",
				"title": "Implement backend database schema for users and devices",
				"description": "Create Postgres schema for user identity, device management, and authentication",
				"details": "Extend screencap-website/lib/db/schema.ts with tables: users (id, username UNIQUE), user_devices (id, user_id, sign_pub_key, dh_pub_key, created_at, last_seen_at). Add proper indexes and constraints. Implement database migrations and ensure username uniqueness is enforced at DB level.",
				"testStrategy": "Unit tests for schema validation, integration tests for user registration and device key storage, test username uniqueness constraints",
				"priority": "high",
				"dependencies": ["1"],
				"status": "done",
				"subtasks": [],
				"updatedAt": "2026-01-04T12:12:47.422Z"
			},
			{
				"id": "3",
				"title": "Implement signed request authentication system",
				"description": "Create request verification system using device signing keys for API authentication",
				"details": "Create screencap-website/lib/auth/verify.ts with functions to parse headers (x-user-id, x-device-id, x-ts, x-sig), verify timestamp window (abs(now - ts) <= windowMs), verify Ed25519 signature over canonical string (method + path + ts + sha256(body)), and load device public key from user_devices table. Include middleware for protecting API routes.",
				"testStrategy": "Unit tests for signature verification, test timestamp window validation, test malformed request handling, integration tests with mock signed requests",
				"priority": "high",
				"dependencies": ["1", "2"],
				"status": "done",
				"subtasks": [],
				"updatedAt": "2026-01-04T12:13:16.224Z"
			},
			{
				"id": "4",
				"title": "Create user registration and identity management APIs",
				"description": "Implement backend APIs for user registration, device management, and identity operations",
				"details": "Create API routes: POST /api/users/register (username, device pubkeys â†’ userId+deviceId), POST /api/users/rename (signed), GET /api/me (signed). Implement username validation, device key storage, and proper error handling. Ensure atomic operations for user creation.",
				"testStrategy": "API integration tests for registration flow, test username collision handling, test device key validation, test signed request authentication",
				"priority": "high",
				"dependencies": ["2", "3"],
				"status": "done",
				"subtasks": [],
				"updatedAt": "2026-01-04T12:14:33.780Z"
			},
			{
				"id": "5",
				"title": "Implement friends system database schema and APIs",
				"description": "Create database schema and APIs for friend requests and friendship management",
				"details": "Add schema: friend_requests (id, from_user_id, to_user_id, status, created_at, responded_at), friendships (user_a, user_b, created_at, UNIQUE(user_a,user_b)). Implement APIs: POST /api/friends/requests, GET /api/friends, GET /api/friends/requests, POST /api/friends/requests/{id}/accept|reject. Ensure mutual friendship and prevent duplicate requests.",
				"testStrategy": "Test friend request creation and acceptance flow, test duplicate request prevention, test friendship bidirectionality, test request status transitions",
				"priority": "medium",
				"dependencies": ["2", "3"],
				"status": "done",
				"subtasks": [],
				"updatedAt": "2026-01-04T12:15:58.265Z"
			},
			{
				"id": "6",
				"title": "Implement rooms database schema and core APIs",
				"description": "Create database schema for rooms, membership, and key distribution",
				"details": "Add schema: rooms (id, kind='project', name, visibility='private|public', created_by, created_at), room_members (room_id, user_id, role, joined_at), room_invites (id, room_id, from_user_id, to_user_id, status), room_member_keys (room_id, device_id, envelope_json, created_at). Implement APIs for room creation, membership management, and key envelope storage.",
				"testStrategy": "Test room creation and membership flows, test key envelope storage and retrieval, test invite system, test access control for room operations",
				"priority": "high",
				"dependencies": ["2", "3"],
				"status": "done",
				"subtasks": [],
				"updatedAt": "2026-01-04T12:17:25.803Z"
			},
			{
				"id": "7",
				"title": "Implement encrypted events schema and APIs",
				"description": "Create database schema and APIs for storing encrypted timeline events and images",
				"details": "Add schema: room_events (id, room_id, author_user_id, timestamp_ms, payload_ciphertext TEXT, image_ref TEXT NULL, created_at). Implement APIs: POST /api/rooms/{roomId}/events, GET /api/rooms/{roomId}/events, POST /api/rooms/{roomId}/events/{eventId}/image. Integrate with Vercel Blob for encrypted image storage.",
				"testStrategy": "Test encrypted event storage and retrieval, test image upload to Blob storage, test event listing with pagination, test access control for room events",
				"priority": "high",
				"dependencies": ["6"],
				"status": "done",
				"subtasks": [],
				"updatedAt": "2026-01-04T12:18:38.037Z"
			},
			{
				"id": "8",
				"title": "Implement chat system database schema and APIs",
				"description": "Create database schema and APIs for DM and project group chat functionality",
				"details": "Add schema: chat_threads (id, kind='dm|project', room_id NULL, created_at), chat_thread_members (thread_id, user_id, joined_at), chat_messages (id, thread_id, author_user_id, timestamp_ms, ciphertext TEXT, created_at). Implement APIs for thread creation, message posting, and message retrieval with pagination.",
				"testStrategy": "Test DM thread creation and messaging, test project chat threads, test message encryption storage, test thread membership management",
				"priority": "medium",
				"dependencies": ["6"],
				"status": "done",
				"subtasks": [],
				"updatedAt": "2026-01-04T12:19:49.050Z"
			},
			{
				"id": "9",
				"title": "Implement desktop IdentityService for key management",
				"description": "Create Electron main service for device key generation, secure storage, and request signing",
				"details": "Create screencal/electron/main/features/social/IdentityService.ts with functions for: Ed25519/X25519 keypair generation, secure key storage using OS keychain (similar to existing safeStorage usage), username registration with server, signed request helper for API calls. Store private keys encrypted in OS secure storage.",
				"testStrategy": "Test key generation and storage, test secure key retrieval, test request signing functionality, test username registration flow",
				"priority": "high",
				"dependencies": ["1", "4"],
				"status": "done",
				"subtasks": [],
				"updatedAt": "2026-01-04T12:22:15.827Z"
			},
			{
				"id": "10",
				"title": "Implement desktop FriendsService and tray UI",
				"description": "Create service for friend management and tray popup UI for friend operations",
				"details": "Create screencal/electron/main/features/social/FriendsService.ts for friend request operations and local caching. Implement IPC handlers and update tray popup UI in screencal/src/components/popup/StreakPopup.tsx to add Friends tab with: add friend by username, pending requests list, friend list with shared projects.",
				"testStrategy": "Test friend request sending and acceptance, test tray UI interactions, test friend list synchronization, test offline friend cache",
				"priority": "medium",
				"dependencies": ["5", "9"],
				"status": "done",
				"subtasks": [],
				"updatedAt": "2026-01-04T12:27:12.245Z"
			},
			{
				"id": "11",
				"title": "Implement room cryptography and key management",
				"description": "Create cryptographic utilities for room key generation, envelope creation, and content encryption",
				"details": "Create screencal/electron/main/features/rooms/RoomCrypto.ts with: 32-byte room key generation, X25519 ECDH + AES-GCM envelope creation for key distribution, AES-GCM encryption/decryption for events and images, HKDF key derivation for chat subkeys. Implement proper nonce handling and key rotation support.",
				"testStrategy": "Test room key generation and distribution, test envelope encryption/decryption, test event encryption with proper nonce handling, test key derivation for chat",
				"priority": "high",
				"dependencies": ["1", "9"],
				"status": "done",
				"subtasks": [],
				"updatedAt": "2026-01-04T12:28:04.472Z"
			},
			{
				"id": "12",
				"title": "Implement desktop RoomsService for project sharing",
				"description": "Create service for room creation, member management, and project linking",
				"details": "Create screencal/electron/main/features/rooms/RoomsService.ts for: creating rooms for local projects, inviting friends to rooms, managing room key envelopes, linking local projects to rooms. Extend local SQLite schema with project_room_links and room_keys_cache tables.",
				"testStrategy": "Test room creation for projects, test friend invitation flow, test room key distribution, test project-room linking persistence",
				"priority": "high",
				"dependencies": ["6", "11"],
				"status": "done",
				"subtasks": [],
				"updatedAt": "2026-01-04T12:30:11.277Z"
			},
			{
				"id": "13",
				"title": "Implement RoomSyncService for encrypted progress events",
				"description": "Create service for encrypting and syncing project progress events to rooms",
				"details": "Create screencal/electron/main/features/sync/RoomSyncService.ts for: encrypting progress events and images, uploading to room APIs, fetching and decrypting events from other members, caching events locally. Hook into existing progress capture pipeline to automatically sync shared projects.",
				"testStrategy": "Test progress event encryption and upload, test image encryption and Blob storage, test event fetching and decryption, test automatic sync integration",
				"priority": "high",
				"dependencies": ["7", "11", "12"],
				"status": "done",
				"subtasks": [],
				"updatedAt": "2026-01-04T12:31:38.056Z"
			},
			{
				"id": "14",
				"title": "Implement desktop ChatService and tray messaging UI",
				"description": "Create service for encrypted messaging and tray popup chat interface",
				"details": "Create screencal/electron/main/features/chat/ChatService.ts for: DM and project chat management, message encryption/decryption, polling for new messages, unread state tracking. Update tray popup with Messages tab showing thread list, message composer, and unread badges.",
				"testStrategy": "Test DM thread creation and messaging, test project chat functionality, test message encryption, test unread state management, test tray UI interactions",
				"priority": "medium",
				"dependencies": ["8", "11"],
				"status": "done",
				"subtasks": [],
				"updatedAt": "2026-01-04T12:36:15.377Z"
			},
			{
				"id": "15",
				"title": "Extend local SQLite schema for social features",
				"description": "Add database tables for caching social data, rooms, and chat locally",
				"details": "Extend screencal/electron/main/infra/db/schema.ts with tables: social_account, friends_cache, project_room_links, room_keys_cache, room_events_cache, chat_threads_cache, chat_messages_cache, chat_unread_state. Implement proper migrations and indexing for performance.",
				"testStrategy": "Test database migrations, test data persistence and retrieval, test cache invalidation strategies, test database performance with large datasets",
				"priority": "medium",
				"dependencies": ["9"],
				"status": "done",
				"subtasks": [],
				"updatedAt": "2026-01-04T12:36:59.725Z"
			},
			{
				"id": "16",
				"title": "Implement IPC and preload APIs for social features",
				"description": "Create IPC handlers and renderer APIs for all social, rooms, and chat functionality",
				"details": "Extend screencal/electron/shared/ipc.ts and types.ts with social, rooms, and chat DTOs. Create IPC handlers in screencal/electron/main/ipc/handlers/ for social.ts, rooms.ts, chat.ts. Expose APIs in preload as window.api.social, window.api.rooms, window.api.chat.",
				"testStrategy": "Test IPC communication for all social features, test type safety of DTOs, test error handling in IPC calls, test preload API exposure",
				"priority": "medium",
				"dependencies": ["10", "12", "14"],
				"status": "done",
				"subtasks": [],
				"updatedAt": "2026-01-04T12:38:51.429Z"
			},
			{
				"id": "17",
				"title": "Implement main app sharing UI for project rooms",
				"description": "Add sharing panel to main app for managing project room membership and invites",
				"details": "Update screencal/src/components/progress/ProjectProgressView.tsx to add Sharing panel with: project-to-room mapping display, invite/remove members interface, public link management (for legacy publishing compatibility), room member list with roles.",
				"testStrategy": "Test sharing panel UI interactions, test member invitation flow, test public link generation, test room member management",
				"priority": "medium",
				"dependencies": ["12", "16"],
				"status": "done",
				"subtasks": [],
				"updatedAt": "2026-01-04T12:40:31.425Z"
			},
			{
				"id": "18",
				"title": "Migrate legacy publishing to use rooms backend",
				"description": "Re-implement existing publishing system on top of rooms while maintaining API compatibility",
				"details": "Keep existing API routes in screencap-website/app/api/published-projects/ and screencap-website/app/p/[publicId]/page.tsx but implement them using rooms backend. Map published projects to public rooms, maintain writeKey compatibility or migrate to device authentication. Provide migration path for existing published projects.",
				"testStrategy": "Test legacy API compatibility, test existing public page URLs, test writeKey authentication, test migration of existing published projects",
				"priority": "medium",
				"dependencies": ["7", "13"],
				"status": "done",
				"subtasks": [],
				"updatedAt": "2026-01-04T12:46:22.250Z"
			},
			{
				"id": "19",
				"title": "Integrate room sync with existing progress capture pipeline",
				"description": "Hook room synchronization into the existing screenshot and progress capture workflow",
				"details": "Modify screencal/electron/main/ipc/handlers/storage.ts to call room sync after SubmitProjectProgressCapture. Update or replace PublishingService to use RoomsService as backend. Ensure both room sharing and legacy publishing work simultaneously during transition.",
				"testStrategy": "Test automatic room sync on progress capture, test dual publishing to rooms and legacy system, test progress capture performance impact",
				"priority": "high",
				"dependencies": ["13", "18"],
				"status": "in-progress",
				"subtasks": [],
				"updatedAt": "2026-01-04T12:46:28.520Z"
			},
			{
				"id": "20",
				"title": "Implement security hardening and abuse prevention",
				"description": "Add rate limiting, validation, and security controls for production deployment",
				"details": "Implement rate limiting for username registration and friend requests, add input validation and sanitization for all user inputs, implement basic abuse reporting and blocking mechanisms, add monitoring and logging for security events, implement proper error handling that doesn't leak sensitive information.",
				"testStrategy": "Test rate limiting effectiveness, test input validation edge cases, test abuse reporting workflow, test security monitoring and alerting",
				"priority": "medium",
				"dependencies": ["4", "5", "6", "8"],
				"status": "pending",
				"subtasks": []
			}
		],
		"metadata": {
			"version": "1.0.0",
			"lastModified": "2026-01-04T12:46:28.520Z",
			"taskCount": 20,
			"completedCount": 18,
			"tags": ["master"]
		}
	}
}
